{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container">
  <!-- Шапка акта -->
  <div class="row">
    <div class="col-5">
      <p class="text-center">{{actt.lpu.name}}</p>
      <p class="text-center">{{actt.lpu.index}}, {{actt.lpu.zip}}, г. {{actt.lpu.city}}, {{actt.lpu.adress}}</p>
      <p class="text-center">Тел. {{actt.lpu.phone}}</p>
    </div>
    <div class="col-2"></div>
    <div class="col">
      <p class="fs-6 text-center">АО ПТП «Медтехника»</p>
      <p class="text-center">620085, г. Екатеринбург, ул. Учителей, д. 30</p>
      <p class="text-center">Тел. (343) 380-80-70</p>
    </div>
  </div>
  
  <div class="starter-template text-center py-4 px-3"></div>
  
  <!-- Дата и место -->
  <div class="row">
    <div class="col-3">
      <p class="text-center text-decoration-underline">г. {{actt.lpu.city}}</p>
    </div>
    <div class="col-6"></div>
    <div class="col-3">
      <p class="text-center text-decoration-underline">Дата: {{actt.creation_date|date:"d.m.Y\г."}}</p>
    </div>
  </div>

  <!-- Номер акта (теперь с ID) -->
  <div class="row">
    <h4 class="text-center">АКТ № {{actt.id}}</h4>
    <h6 class="text-center fw-bold">технического состояния медицинской техники</h6>
  </div>
  
  <!-- Состав комиссии -->
  <div class="row">
    <div class="col">
      <p class="text-start fw-bold">Комиссия в составе:</p>
    </div>
  </div>

  <div class="row">
    <div class="col-auto">
      <p class="text-start">Представителя сервисного центра:</p>
    </div>
    <div class="col-auto">
      <p class="text-end fst-italic text-decoration-underline">{{actt.user.get_full_name|default:actt.user.username}}</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col-auto">
      <p class="text-start">Главного инженера сервисного центра:</p>
    </div>
    <div class="col-auto">
      <p class="text-end fst-italic text-decoration-underline">Р.В.Амурского</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col">
      <p class="text-start">
        с участием представителя учреждения / владельца
        {% if actt.representative_1 %}
          {{ actt.representative_1 }}
        {% else %}
          _______________________________________
        {% endif %}
      </p>
    </div>
  </div>
  
  <!-- Информация об оборудовании -->
  <div class="row">
    <div class="col">
      <p class="text-start">Проверила техническое состояние: {{actt.device.name}}</p>
    </div>
  </div>

  <div class="row">
    <div class="col-auto">
      <p class="text-start">Модель:</p>
    </div>
    <div class="col-auto">
      <p class="text-start fst-italic text-decoration-underline">{{actt.device.model|default:"не указано"}}</p>
    </div>
    <div class="col-auto">
      <p class="text-start">заводской номер:</p>
    </div>
    <div class="col-auto">
      <p class="text-start fst-italic text-decoration-underline">{{actt.device.serial_number|default:"не указан"}}</p>
    </div>
  </div>
  
  <!-- Остальные поля оборудования -->
  <div class="row">
    <div class="col-auto">
      <p class="text-start">завод-изготовитель:</p>
    </div>
    <div class="col-auto">
      <p class="text-start fst-italic text-decoration-underline">{{actt.device.manufacturer|default:"не указан"}}</p>
    </div>
    <div class="col-auto">
      <p class="text-start">страна:</p>
    </div>
    <div class="col-auto">
      <p class="text-start fst-italic text-decoration-underline">{{actt.device.country|default:"не указана"}}</p>
    </div>
  </div>
  
  <!-- Даты -->
  <div class="row">
    <div class="col-auto">
      <p class="text-start">дата изготовления:</p>
    </div>
    <div class="col-auto">
      <p class="text-start fst-italic text-decoration-underline">
        {% if actt.device.year_of_manufacture %}
          {{ actt.device.year_of_manufacture|date:"d.m.Y" }}
        {% else %}
          не указана
        {% endif %}
      </p>
    </div>
    <div class="col-auto">
      <p class="text-start">дата продажи:</p>
    </div>
    <div class="col-auto">
      <p class="text-start fst-italic text-decoration-underline">
        {% if actt.device.year_of_sale %}
          {{ actt.device.year_of_sale|date:"d.m.Y" }}
        {% else %}
          не указана
        {% endif %}
      </p>
    </div>
  </div>
  
  <div class="row">
    <div class="col-auto">
      <p class="text-start">дата ввода в эксплуатацию:</p>
    </div>
    <div class="col-auto">
      <p class="text-start fst-italic text-decoration-underline">
        {% if actt.device.commissioning_date %}
          {{ actt.device.commissioning_date|date:"d.m.Y" }}
        {% else %}
          не указана
        {% endif %}
      </p>
    </div>
  </div>
  
  <div class="starter-template text-center py-2 px-1"></div>
  
  <!-- Результаты проверки -->
  <div class="row">
    <div class="col">
      <p class="text-start fw-bold">При проверке изделия медицинской техники установлено:</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col">
      <p class="text-start fst-italic text-decoration-underline">{{actt.check_result|default:"не указано"}}</p>
    </div>
  </div>
  
  <div class="starter-template text-center py-2 px-1"></div>
  
  <!-- Вероятные причины -->
  <div class="row">
    <div class="col">
      <p class="text-start fw-bold">Вероятные причины:</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col">
      <p class="text-start fst-italic text-decoration-underline">{{actt.probable_cause|default:"не указаны"}}</p>
    </div>
  </div>
  
  <div class="starter-template text-center py-2 px-1"></div>
  
  <!-- Заключение -->
  <div class="row">
    <div class="col">
      <p class="text-start fw-bold">Заключение комиссии:</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col">
      <p class="text-start fst-italic text-decoration-underline">{{actt.conclusion|default:"не указано"}}</p>
    </div>
  </div>
  
  <!-- Примечание -->
  <div class="row" style="font-size: 8px">
    <div class="col-12">
      <p class="text-start lh-sm">Отпечатано в 2-х экземплярах:</p>
    </div>
    <div class="col-12">
      <p class="text-start lh-sm">1. Учреждению /владельцу –1 экз.;</p>
    </div>
    <div class="col">
      <p class="text-start lh-sm">2. Предприятию технического сервиса –1 экз.;</p>
    </div>
  </div>
  
  <!-- Подписи -->
  <div class="row">
    <div class="col-auto">
      <p class="text-start">Представители АО «ПТП «Медтехника»:</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col-7">
      <p class="text-start">Представитель сервисного центра</p>
    </div>
    <div class="col-3">
      <p class="text-end">_____________</p>
    </div>
    <div class="col-2">
      <p class="text-start fst-italic text-decoration-underline">{{actt.user.get_full_name|default:actt.user.username}}</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col-7">
      <p class="text-end">Главный инженер сервисного центра</p>
    </div>
    <div class="col-3">
      <p class="text-end">_____________</p>
    </div>
    <div class="col-2">
      <p class="text-start fst-italic text-decoration-underline">Р.В.Амурский</p>
    </div>
  </div>
  
  <div class="starter-template text-center py-4 px-3"></div>
  
  <!-- Подписи представителей учреждения -->
  <div class="row">
    <div class="col-auto">
      <p class="text-start">Представители учреждения /владельца:</p>
    </div>
  </div>
  
  <div class="row">
    <div class="col-7">
      <p class="text-start">
        {% if actt.representative_1 %}
          {{ actt.representative_1 }}
        {% else %}
          __________________________________________
        {% endif %}
      </p>
    </div>
    <div class="col-3">
      <p class="text-end">_____________</p>
    </div>
    <div class="col-2">
      <p class="text-start fst-italic text-decoration-underline">
        {% if actt.representative_1_position %}
          {{ actt.representative_1_position }}
        {% else %}
          ________________________
        {% endif %}
      </p>
    </div>
  </div>
  
  <div class="row">
    <div class="col-7">
      <p class="text-end">
        {% if actt.representative_2 %}
          {{ actt.representative_2 }}
        {% else %}
          __________________________________________
        {% endif %}
      </p>
    </div>
    <div class="col-3">
      <p class="text-end">_____________</p>
    </div>
    <div class="col-2">
      <p class="text-start fst-italic text-decoration-underline">
        {% if actt.representative_2_position %}
          {{ actt.representative_2_position }}
        {% else %}
          ________________________
        {% endif %}
      </p>
    </div>
  </div>
</div>

<!-- Кнопки действий -->
<div class="container mt-4">
  <div class="row">
    <div class="col">
      <a class="btn btn-primary" href="{% url 'act_technical:act_edit' pk=actt.id %}" role="button">
        <i class="fas fa-edit"></i> Редактировать
      </a>
      <a class="btn btn-primary ms-2" href="{% url 'act_technical:act_edit2' pk=actt.id %}" role="button">
        <i class="fas fa-copy"></i> Сохранить как новый
      </a>
      <button type="button" class="btn btn-secondary ms-2" onclick="printAct()">
        <i class="fas fa-print"></i> Печать
      </button>
      {% comment %} <a href="{% url 'act_technical:act_pdf' pk=actt.id %}" class="btn btn-info ms-2">
        <i class="fas fa-file-pdf"></i> PDF
      </a> {% endcomment %}
    </div>
  </div>
</div>

<!-- Форма комментариев -->
{% comment %} <div class="container mt-4">
  <form method="post" action="{% url 'act_technical:add_comment' pk=actt.id %}">
    {% csrf_token %}
    <div class="mb-3">
      <label for="commentTextarea" class="form-label">Комментарии</label>
      <textarea class="form-control" id="commentTextarea" name="comment" rows="3"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Отправить</button>
  </form>
</div> {% endcomment %}

<!-- Скрипт для печати -->
<script>
function printAct() {
  window.print();
}
</script>

<!-- Стили для печати -->
<style>
@media print {
  body * {
    visibility: hidden;
  }
  .container, .container * {
    visibility: visible;
  }
  .container {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
  }
  .no-print, .no-print * {
    display: none !important;
  }
  .btn {
    display: none !important;
  }
  textarea {
    border: none;
    resize: none;
    background: transparent;
  }
}
</style>

{% endblock %}