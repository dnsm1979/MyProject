{% extends "base.html" %}
{% load static %}
{% load param_replace %}

{% block body %}
</li>
<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Создать новый акт</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="#">Акт ввода в эксплуатацию</a></li>
    <li><a class="dropdown-item" href="{% url "act_technical:act_add" %}">Акт технического состояния</a></li>
    <li><a class="dropdown-item" href="#">Отчет о выполненой работе</a></li>
  </ul>
</li>

</ul>
          

{% endblock  %}


{% block content %}
<div class="starter-template text-center py-5 px-3">
  <img src="{% static '\images\1.png' %}" class="img-fluid" alt="logo">
  <p class="lead">База оформленных документов</p>
</div>
<div class="container mt-4">
    <!-- Форма фильтрации -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>Фильтры</h5>
        </div>
        <div class="card-body">
            <form method="get" class="row g-3">
                <!-- Поиск -->
                <div class="col-md-3">
                    <input type="text" class="form-control" name="q" 
                           placeholder="Поиск..." value="{{ current_filters.q }}">
                </div>
                
                <!-- ЛПУ -->
                <div class="col-md-2">
                    <select class="form-select" name="lpu">
                        <option value="">Все ЛПУ</option>
                        {% for lpu in all_lpus %}
                        <option value="{{ lpu.id }}" 
                                {% if current_filters.lpu == lpu.id|stringformat:"s" %}selected{% endif %}>
                            {{ lpu.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Создатель -->
                <div class="col-md-2">
                    <select class="form-select" name="creator">
                        <option value="">Все создатели</option>
                        {% for creator in all_creators %}
                        <option value="{{ creator.id }}"
                                {% if current_filters.creator == creator.id|stringformat:"s" %}selected{% endif %}>
                            {{ creator.get_full_name|default:creator.username }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Даты -->
                <div class="col-md-3">
                    <div class="input-group">
                        <span class="input-group-text">Дата от</span>
                        <input type="date" class="form-control" name="date_from" 
                               value="{{ current_filters.date_from }}">
                        <span class="input-group-text">до</span>
                        <input type="date" class="form-control" name="date_to" 
                               value="{{ current_filters.date_to }}">
                    </div>
                </div>
                                <!-- Чекбокс для активных комментариев -->
                <div class="col-md-2 form-check form-switch">
                    <input class="form-check-input" type="checkbox" 
                        id="activeComments" name="active_comments"
                        {% if active_comments_filter %}checked{% endif %}>
                    <label class="form-check-label" for="activeComments">
                        Только с активными комментариями
                    </label>
                </div>

                
                <!-- Кнопки -->
                <div class="container mt-4">
                <div class="row justify-content-end">  <!-- Выравнивание по правому краю -->
                    <div class="col-auto">  <!-- Автоматическая ширина по содержимому -->
                    <div class="d-flex gap-2">  <!-- Горизонтальное расположение с небольшим отступом -->
                        <button type="submit" class="btn btn-primary">
                        <i class="fas fa-filter"></i> Применить
                        </button>
                        <a href="{% url 'main:index' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times"></i> Сбросить
                        </a>
                    </div>
                    </div>
                </div>
                </div>

            </form>
        </div>
    </div>

    <!-- Таблица с актами -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <!-- Заголовки таблицы -->
            <thead>
                <tr>
                    <th><img src="{% static '\images\chat-left-text.svg' %}" class="img-fluid" alt="logo"></th>
                    <th>Название</th>
                    <th>ЛПУ</th>
                    <th>Аппарат</th>
                    <th>Дата</th>
                    <th>Создал</th>
                    <th><img src="{% static '\images\images.svg' %}" class="img-fluid" alt="logo"></th>
                </tr>
            </thead>
            <!-- Данные таблицы -->
            <tbody>
                {% for act in page_obj %}
                <tr>
                    <td>
                        {% if act.has_active_comments %}
                            <img src="{% static '\images\check-circle-fill.svg' %}" class="img-fluid" alt="logo">
                        {% endif %}</td>
                    <td><a href="{% url 'act_technical:act_change' act.id %}">{{ act.name }}</a></td>
                    
                    <td>{{ act.lpu.name }}</td>
                    <td>{{ act.device.model }}</td>
                    <td>{{ act.creation_date|date:"d.m.Y" }}</td>
                    <td>{{ act.user.get_full_name|default:act.user.username }}</td>
                    <td>
                        {% if act.has_images %}
                            <img src="{% static '\images\image.svg' %}" class="img-fluid" alt="logo">
                        {% endif %}</td>


                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">Нет актов для отображения</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Пагинация с сохранением фильтров -->

    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?{% param_replace page=1 %}">&laquo;</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?{% param_replace page=page_obj.previous_page_number %}">&lsaquo;</a>
                </li>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <li class="page-item"><a class="page-link" href="?{% param_replace page=num %}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            
            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?{% param_replace page=page_obj.next_page_number %}">&rsaquo;</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?{% param_replace page=page_obj.paginator.num_pages %}">&raquo;</a>
                </li>
            {% endif %}
        </ul>
    </nav>
    
    <div class="text-center text-muted mt-2">
        Показано с {{ page_obj.start_index }} по {{ page_obj.end_index }} из {{ page_obj.paginator.count }} актов
    </div>
</div>
<style>
/* Стили для формы фильтрации */
.filter-form .input-group-text {
    min-width: 80px;
}

/* Адаптивность */
@media (max-width: 768px) {
    .filter-form .col-md-2, 
    .filter-form .col-md-3 {
        margin-bottom: 10px;
    }
}
.form-check-input:checked {
    background-color: #0d6efd;
    border-color: #0d6efd;
}

.badge {
    font-size: 0.85em;
    font-weight: normal;
}
.fa-leaf {
    margin-right: 5px;
    font-size: 0.9em;
    transition: transform 0.2s;
}

.fa-leaf:hover {
    transform: scale(1.2);
}
</style>

{% endblock %}